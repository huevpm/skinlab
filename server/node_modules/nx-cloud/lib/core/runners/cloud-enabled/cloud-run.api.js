const a3_0xe0d2=['apiAxiosInstance','nxCloudVersion','recordMetric','axiosException','promisify','zlib','createMetricRecorder','runContext','toString','post','createApiAxiosInstance','/nx-cloud/runs/start','__awaiter','endRun','getCIExecutionEnv','__esModule','data','gzip','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','success','note','RunEnd\x20duration','assign','defaults','uploadedToStorage','Invalid\x20end\x20run\x20response:\x20','VERBOSE_LOGGING','urls','throw','nx-cloud','../../../utilities/metric-logger','Stack\x20Trace:','RunStart','message','stack','api','terminalOutput','util','axiosMultipleTries','RunStart\x20duration','devDependencies','application/octet-stream','error','unknown','defineProperty','RunEnd.\x20Completed\x20tasks','../../../utilities/environment','/nx-cloud/runs/end','Run\x20Details:','response','getRunGroup','../../../utilities/is-private-cloud','status','headers','getCIExecutionId','isConnectedToPrivateCloud','next','extractErrorMessage','messages','../../../utilities/axios','value','getBranch','CloudRunApi','createReqBody','apiError','done','RUNNER_FAILURE_PERF_ENTRY','length','parse','runUrl','string','startRun','stringify','printDuration','mapRespToPerfEntry','machineInfo'];(function(_0x33e857,_0xe0d2c6){const _0x10de75=function(_0x1841bf){while(--_0x1841bf){_0x33e857['push'](_0x33e857['shift']());}};_0x10de75(++_0xe0d2c6);}(a3_0xe0d2,0x13e));const a3_0x10de=function(_0x33e857,_0xe0d2c6){_0x33e857=_0x33e857-0x0;let _0x10de75=a3_0xe0d2[_0x33e857];return _0x10de75;};'use strict';var __awaiter=this&&this[a3_0x10de('0x4a')]||function(_0x5208ce,_0x2f8a8e,_0x470f95,_0x1d4908){function _0x27cf35(_0x372771){return _0x372771 instanceof _0x470f95?_0x372771:new _0x470f95(function(_0x34a2d6){_0x34a2d6(_0x372771);});}return new(_0x470f95||(_0x470f95=Promise))(function(_0xff2eea,_0x2a6c7d){function _0x4286ac(_0x45493c){try{_0x5f4969(_0x1d4908[a3_0x10de('0x2a')](_0x45493c));}catch(_0x40379a){_0x2a6c7d(_0x40379a);}}function _0x379988(_0x26a5cb){try{_0x5f4969(_0x1d4908[a3_0x10de('0xe')](_0x26a5cb));}catch(_0x2db8ef){_0x2a6c7d(_0x2db8ef);}}function _0x5f4969(_0x4616f0){_0x4616f0[a3_0x10de('0x33')]?_0xff2eea(_0x4616f0[a3_0x10de('0x2e')]):_0x27cf35(_0x4616f0[a3_0x10de('0x2e')])['then'](_0x4286ac,_0x379988);}_0x5f4969((_0x1d4908=_0x1d4908['apply'](_0x5208ce,_0x2f8a8e||[]))['next']());});};Object[a3_0x10de('0x1e')](exports,a3_0x10de('0x1'),{'value':!![]});exports['CloudRunApi']=void 0x0;const fs_1=require('fs');const util_1=require(a3_0x10de('0x17'));const zlib_1=require(a3_0x10de('0x43'));const axios_1=require(a3_0x10de('0x2d'));const environment_1=require(a3_0x10de('0x20'));const is_private_cloud_1=require(a3_0x10de('0x25'));const metric_logger_1=require(a3_0x10de('0x10'));const {output}=require('../../../utilities/nx-imports-light');class CloudRunApi{constructor(_0x5db8ed,_0x451184,_0x2de17f,_0x5e1839){this[a3_0x10de('0x2c')]=_0x5db8ed;this[a3_0x10de('0x45')]=_0x451184;this['machineInfo']=_0x5e1839;this[a3_0x10de('0x3e')]=(0x0,axios_1[a3_0x10de('0x48')])(_0x2de17f);}[a3_0x10de('0x39')](_0x356e79,_0x2d853a){var _0x1425d8;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x10de('0x2c')][a3_0x10de('0x32')])return{};const _0x221efa=(0x0,metric_logger_1[a3_0x10de('0x44')])(a3_0x10de('0x39'));try{const _0xe0831b={'meta':{'nxCloudVersion':this[a3_0x10de('0x3f')]()},'branch':(0x0,environment_1[a3_0x10de('0x2f')])(),'runGroup':(0x0,environment_1[a3_0x10de('0x24')])(),'ciExecutionId':(0x0,environment_1[a3_0x10de('0x28')])(),'ciExecutionEnv':(0x0,environment_1[a3_0x10de('0x0')])(),'distributedExecutionId':_0x356e79,'hashes':_0x2d853a,'machineInfo':this[a3_0x10de('0x3d')]};if(environment_1[a3_0x10de('0xc')]){output[a3_0x10de('0x6')]({'title':a3_0x10de('0x12'),'bodyLines':['\x0a'+JSON[a3_0x10de('0x3a')](_0xe0831b,null,0x2)]});}const _0x58b327=yield(0x0,axios_1[a3_0x10de('0x3b')])(a3_0x10de('0x19'),()=>(0x0,axios_1[a3_0x10de('0x18')])(()=>this['apiAxiosInstance'][a3_0x10de('0x47')](a3_0x10de('0x49'),_0xe0831b)));_0x221efa[a3_0x10de('0x40')]((0x0,metric_logger_1[a3_0x10de('0x3c')])(_0x58b327));if(_0x58b327[a3_0x10de('0x2')]&&_0x58b327['data'][a3_0x10de('0x13')]){this[a3_0x10de('0x2c')]['message']=_0x58b327[a3_0x10de('0x2')][a3_0x10de('0x13')];}if(!_0x58b327[a3_0x10de('0x2')]||!_0x58b327[a3_0x10de('0x2')][a3_0x10de('0xd')]){this[a3_0x10de('0x2c')][a3_0x10de('0x32')]='Invalid\x20Nx\x20Cloud\x20response:\x20'+JSON[a3_0x10de('0x3a')](_0x58b327['data']);return{};}return _0x58b327[a3_0x10de('0x2')][a3_0x10de('0xd')];}catch(_0x181e2f){_0x221efa['recordMetric'](((_0x1425d8=_0x181e2f===null||_0x181e2f===void 0x0?void 0x0:_0x181e2f['axiosException'])===null||_0x1425d8===void 0x0?void 0x0:_0x1425d8[a3_0x10de('0x23')])?(0x0,metric_logger_1[a3_0x10de('0x3c')])(_0x181e2f[a3_0x10de('0x41')][a3_0x10de('0x23')]):metric_logger_1[a3_0x10de('0x34')]);this[a3_0x10de('0x2c')][a3_0x10de('0x32')]=this['messages'][a3_0x10de('0x2b')](_0x181e2f,'api');return{};}});}[a3_0x10de('0x31')](_0x3ff760,_0x29c0af,_0x45b145,_0x493ac8){if((0x0,is_private_cloud_1[a3_0x10de('0x29')])()){for(let _0xf3bf5 of _0x29c0af){delete _0xf3bf5[a3_0x10de('0xa')];}}const _0xe5ad9c=Object[a3_0x10de('0x8')](Object[a3_0x10de('0x8')]({'meta':{'nxCloudVersion':this[a3_0x10de('0x3f')]()},'tasks':_0x29c0af,'run':_0x3ff760,'linkId':_0x493ac8},(0x0,is_private_cloud_1[a3_0x10de('0x29')])()?{}:_0x45b145),{'machineInfo':this[a3_0x10de('0x3d')]});return JSON[a3_0x10de('0x3a')](_0xe5ad9c);}[a3_0x10de('0x4b')](_0x3419c2,_0x3d7ac8,_0x19b820,_0x1e04b9){var _0x53dfba,_0x11c0cb;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x10de('0x2c')][a3_0x10de('0x32')])return![];let _0x2a2915=this['createReqBody'](_0x3419c2,_0x3d7ac8,_0x19b820,_0x1e04b9);if(_0x2a2915[a3_0x10de('0x35')]>0x14*0x3e8*0x3e8){_0x2a2915=this['createReqBody'](_0x3419c2,_0x3d7ac8['map'](_0x2fc15e=>Object[a3_0x10de('0x8')](Object[a3_0x10de('0x8')]({},_0x2fc15e),{'hashDetails':undefined})),_0x19b820,_0x1e04b9);}const _0x3d79bc=Buffer['from'](_0x2a2915);const _0x48b51c=yield(0x0,util_1[a3_0x10de('0x42')])(zlib_1[a3_0x10de('0x3')])(_0x3d79bc);const _0x1c2b9b=(0x0,metric_logger_1[a3_0x10de('0x44')])(a3_0x10de('0x4b'));try{if(environment_1[a3_0x10de('0xc')]){const _0x4423c6=_0x3d7ac8['map'](_0x23fcbb=>{return Object[a3_0x10de('0x8')](Object['assign']({},_0x23fcbb),{'terminalOutput':_0x23fcbb['terminalOutput']?_0x23fcbb[a3_0x10de('0x16')]['slice'](0x0,0x14)+'...':undefined});});output[a3_0x10de('0x6')]({'title':a3_0x10de('0x1f'),'bodyLines':['\x0a'+JSON[a3_0x10de('0x3a')](_0x4423c6,null,0x2)]});}const _0x1fbe17=yield(0x0,axios_1[a3_0x10de('0x3b')])(a3_0x10de('0x7'),()=>(0x0,axios_1[a3_0x10de('0x18')])(()=>this[a3_0x10de('0x3e')][a3_0x10de('0x47')](a3_0x10de('0x21'),_0x48b51c,{'headers':Object['assign'](Object[a3_0x10de('0x8')]({},this[a3_0x10de('0x3e')][a3_0x10de('0x9')][a3_0x10de('0x27')]),{'Content-Encoding':a3_0x10de('0x3'),'Content-Type':a3_0x10de('0x1b')})})));if(_0x1fbe17){_0x1c2b9b['recordMetric']((0x0,metric_logger_1[a3_0x10de('0x3c')])(_0x1fbe17));if(_0x1fbe17[a3_0x10de('0x2')]&&_0x1fbe17[a3_0x10de('0x2')][a3_0x10de('0x37')]&&_0x1fbe17[a3_0x10de('0x2')][a3_0x10de('0x26')]===a3_0x10de('0x5')){this[a3_0x10de('0x45')]['runUrl']=_0x1fbe17[a3_0x10de('0x2')][a3_0x10de('0x37')];return!![];}if(_0x1fbe17['data']&&_0x1fbe17[a3_0x10de('0x2')]['status']){this[a3_0x10de('0x2c')][a3_0x10de('0x32')]='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x1fbe17[a3_0x10de('0x2')][a3_0x10de('0x13')]);}else if(_0x1fbe17[a3_0x10de('0x2')]&&typeof _0x1fbe17[a3_0x10de('0x2')]===a3_0x10de('0x38')){if(_0x1fbe17[a3_0x10de('0x2')]!=='success'){this[a3_0x10de('0x2c')]['apiError']=a3_0x10de('0xb')+JSON[a3_0x10de('0x3a')](_0x1fbe17[a3_0x10de('0x2')]);}}else{this[a3_0x10de('0x2c')][a3_0x10de('0x32')]=a3_0x10de('0xb')+JSON['stringify'](_0x1fbe17[a3_0x10de('0x2')]);}if(environment_1[a3_0x10de('0xc')]){output[a3_0x10de('0x6')]({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON[a3_0x10de('0x3a')](_0x1fbe17[a3_0x10de('0x2')],null,0x2)]});}}else{output[a3_0x10de('0x1c')]({'title':a3_0x10de('0x4'),'bodyLines':['Run\x20completion\x20responded\x20with\x20`undefined`.',a3_0x10de('0x22'),JSON[a3_0x10de('0x3a')](_0x3419c2,null,0x2),a3_0x10de('0x11'),JSON[a3_0x10de('0x3a')](new Error()[a3_0x10de('0x14')],null,0x2)]});}return![];}catch(_0x2416c1){_0x1c2b9b[a3_0x10de('0x40')](((_0x53dfba=_0x2416c1===null||_0x2416c1===void 0x0?void 0x0:_0x2416c1['axiosException'])===null||_0x53dfba===void 0x0?void 0x0:_0x53dfba[a3_0x10de('0x23')])?(0x0,metric_logger_1[a3_0x10de('0x3c')])(_0x2416c1[a3_0x10de('0x41')][a3_0x10de('0x23')]):metric_logger_1[a3_0x10de('0x34')]);const _0x38d22e=(_0x11c0cb=_0x2416c1[a3_0x10de('0x41')])!==null&&_0x11c0cb!==void 0x0?_0x11c0cb:_0x2416c1;this['messages'][a3_0x10de('0x32')]=this[a3_0x10de('0x2c')]['extractErrorMessage'](_0x38d22e,a3_0x10de('0x15'));return![];}});}[a3_0x10de('0x3f')](){try{const _0x16e4d0=JSON[a3_0x10de('0x36')]((0x0,fs_1['readFileSync'])('package.json')[a3_0x10de('0x46')]());return _0x16e4d0[a3_0x10de('0x1a')][a3_0x10de('0xf')]||_0x16e4d0[a3_0x10de('0x1a')]['@nrwl/nx-cloud'];}catch(_0x48b460){return a3_0x10de('0x1d');}}}exports[a3_0x10de('0x30')]=CloudRunApi;