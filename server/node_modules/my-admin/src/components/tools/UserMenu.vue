<template>
    <div class="user-wrapper">
        <div class="content-box">
            <!--                    <a href="https://pro.loacg.com/docs/getting-started" target="_blank">
        <span class="action">
          <a-icon type="question-circle-o"></a-icon>
        </span>
      </a> -->
            <notice-icon class="action" v-if="token" />
            <a-dropdown v-if="token">
                <span class="action ant-dropdown-link user-dropdown-menu">
                    <a-avatar class="avatar" size="small" :src="avatar" icon="user" />
                    <span>{{ nickname }}</span>
                </span>
                <a-menu slot="overlay" class="user-dropdown-menu-wrapper">
                    <a-menu-item key="0">
                        <router-link :to="{ path: '/system/Center' }">
                            <a-icon type="user" />
                            <span>个人中心</span>
                        </router-link>
                    </a-menu-item>
                    <a-menu-item key="1">
                        <router-link :to="{ path: '/system/Settings' }">
                            <a-icon type="setting" />
                            <span>账户设置</span>
                        </router-link>
                    </a-menu-item>
                    <a-menu-divider />
                    <a-menu-item key="3">
                        <a href="javascript:;" @click="handleLogout">
                            <a-icon type="logout" />
                            <span>退出登录</span>
                        </a>
                    </a-menu-item>
                </a-menu>
            </a-dropdown>
            <div v-else>
                <a-button @click="handleLogin" type="primary">立即登录</a-button>
            </div>
        </div>
    </div>
</template>
<script>
import NoticeIcon from '#/components/NoticeIcon'
import { mapActions, mapGetters } from 'vuex'

/**
 * token 用于判断是否登录
 */
export default {
    name: 'UserMenu',
    components: {
        NoticeIcon
    },
    computed: {
        ...mapGetters(['nickname', 'avatar', 'token'])
    },
    methods: {
        ...mapActions(['Logout']),
        handleLogout() {
            this.$confirm({
                title: '提示',
                content: '真的要注销登录吗 ?',
                onOk: () => {
                    return this.Logout({}).then(() => {
                        setTimeout(() => {
                            window.location.reload()
                        }, 16)
                    }).catch(err => {
                        this.$message.error({
                            title: '错误',
                            description: err.message
                        })
                    })
                },
                onCancel() {}
            })
        },
        handleLogin() {
            this.$router.push({
                path: '/login'
            })
        }
    }
}
</script>