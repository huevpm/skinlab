<template>
    <div>
        <a-card style="margin-top: 24px" :bordered="false">
            <!-- <div slot="title">
        <a-button type="primary">收到的信息</a-button>
      </div> -->
            <a-list size="large">
                <a-list-item :key="index" v-for="(item, index) in msgList" class="list-item">
                    <a-list-item-meta :description="item.messages.addtime">
                        <a-avatar slot="avatar" style="backgroundColor:#87d068" icon="user" size="large" shape="square" :src="item.user.avatar" />
                        <span slot="title">{{ item.user.nickname || item.user.username || '未设置昵称' }}</span>
                    </a-list-item-meta>
                    <div slot="actions">
                        <a @click="showMsg(item)">查看</a>
                    </div>
                    <div slot="actions">
                        <a @click="Del(item._id)">删除</a>
                    </div>
                    <div class="list-content">
                        <div class="list-content-item" style="width:35%;">
                            <span>标题</span>
                            <p>{{ item.messages.title }}</p>
                        </div>
                        <div class="list-content-item" style="width:45%;overflow: hidden;">
                            <span>内容</span>
                            <p>{{ item.messages.content }}</p>
                        </div>
                    </div>
                </a-list-item>
            </a-list>
        </a-card>
    </div>
</template>
<script>
import { Modal } from 'ant-design-vue';
export default {
    components: {
        //empty
    },
    inject: ["reload"],
    data() {
        return {
            msgList: [{
                messages: {
                    title: '',
                    content: '',
                    addtime: ''
                },
                user: {
                    avatar: ''
                }
            }],
            status: 'all',
            userid: this.$store.state.user.info.userid
        }
    },
    /**
     * 计算属性
     * @type {Object}
     */
    computed: {

    },
    /**
     * 数据监听
     * @type {Object}
     */
    watch: {

    },
    /**
     * 页面加载执行
     * @return {[type]} [description]
     */
    async mounted() {
        this.getMsg()
    },
    /**
     * 页面方法
     * @type {Object}
     */
    methods: {
        getMsg() {
            this.$cloud.messages().get({ type: true }).then(res => {
                this.msgList = res
            })

        },
        showMsg(data) {
            let that = this;
            let h = this.$createElement;
            this.$info({
                title: data.messages.title,
                content: h('div', {}, [
                    h('p', data.messages.content)
                ]),
                onOk() {
                    if (data.status === 0) {
                        that.$cloud.messages().read({ _id: data._id })
                        that.getMsg()
                    }
                }
            });
        },
        Del(id) {
            var that = this;
            this.$confirm({
                title: '确认要删除吗?',
                onOk() {
                    that.$cloud.messages().remove(id).then(res => {
                        if (res) {
                            that.getMsg();
                        }
                    });
                },
                onCancel() {
                    console.log('Cancel');
                }
            });
        }
    }
}
</script>
<style lang="less" scoped>
.ant-avatar-lg {
    width: 48px;
    height: 48px;
    line-height: 48px;
}

.list-content {
    width: 100%;
}

.list-content-item {
    color: rgba(0, 0, 0, .45);
    display: inline-block;
    vertical-align: middle;
    font-size: 14px;
    margin-left: 30px;

    span {
        line-height: 20px;
    }

    p {
        margin-top: 4px;
        margin-bottom: 0;
        line-height: 22px;
    }
}
</style>