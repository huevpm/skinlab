<template>
    <a-card :bordered="false">
        <div class="table-operator">
            <a-button type="primary" icon="plus" v-popup.menu>新建</a-button>
        </div>
        <div class="table-page-search-wrapper">
            <a-table rowKey="menuId" :columns="columns" :dataSource="data">
                <template slot="show" slot-scope="text, record">
                    <a-switch :checked="record.show" @change="showChange(record)" />
                    <!-- {{record.show?"显示":"隐藏"}} -->
                </template>
                <template slot="operation" slot-scope="text, record">
                    <a v-popup.menu="record" :data-id="record._id">编辑</a>
                    <a-divider type="vertical" />
                    <a @click="Del(record.menuId)">删除</a>
                </template>
            </a-table>
        </div>
    </a-card>
</template>
<script type="text/javascript">
import Vue from 'vue'
import { Tree } from 'ant-design-vue'
Vue.use(Tree);

const columns = [{
        title: '标题',
        dataIndex: 'title'
    },
    {
        title: '名称',
        dataIndex: 'name',
        width: '15%'
    },
    {
        title: '状态',
        dataIndex: 'show',
        scopedSlots: { customRender: 'show' },
        width: '15%'
    },
    {
        title: '操作',
        dataIndex: 'operation',
        width: '10%',
        scopedSlots: { customRender: 'operation' },
    }
];

export default {
    data() {
        return {
            data: [],
            columns
        }
    },
    inject: ["reload"],
    /**
     * 计算属性
     * @type {Object}
     */
    computed: {

    },
    /**
     * 数据监听
     * @type {Object}
     */
    watch: {

    },
    /**
     * 页面加载执行
     * @return {[type]} [description]
     */
    async mounted() {
        this.getMuneu();
    },
    /**
     * 页面方法
     * @type {Object}
     */
    methods: {
        getMuneu() {
            this.$cloud.menus().all().then(res => {
                let toTree = {
                    parentKey: "parentId",
                    idKey: "menuId",
                    parentId: 0,
                    childrenKey: "children"
                }
                let residences = this.$cloud.tree(toTree).on(res).get();
                this.data = residences;
            });
        },
        showChange(data) {
            let show = !data.show;
            this.$cloud.menus().edit(data.menuId, { show }).then(res => {
                if (res) {
                    this.getMuneu();
                }
            });
        },
        Del(menuId) {
            var that = this;
            this.$confirm({
                title: '确认要删除吗?',
                onOk() {

                    that.$cloud.menus().remove(menuId).then(res => {
                        if (res) {
                            that.getMuneu();
                        }
                    });
                },
                onCancel() {
                    console.log('Cancel');
                }
            });
        }
    }
}
</script>
<style type="text/css" lang="scss">
</style>