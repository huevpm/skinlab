<template>
  <a-form :form="form">
    <a-form-item label="账号" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
      <a-input v-decorator="['username', { rules: [{ required: true, message: 'Please input your note!' }] }]" />
    </a-form-item>
    <a-form-item label="密码" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }" v-if="id == 0">
      <a-input v-decorator="['password', { rules: [{ required: true, message: 'Please input your note!' }] }]" />
    </a-form-item>
    <a-form-item label="邮箱" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
      <a-input v-decorator="['email', { rules: [{ required: true, message: 'Please input your note!' }] }]" />
    </a-form-item>
    <a-form-item label="昵称" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
      <a-input v-decorator="['nickname', { rules: [{ required: true, message: 'Please input your note!' }] }]" />
    </a-form-item>
    <a-form-item label="角色" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
      <a-input v-decorator="['role', { rules: [{ required: true, message: 'Please input your note!' }] }]" />
    </a-form-item>
    <a-form-item label="状态" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
      <a-switch v-decorator="['status', { valuePropName: 'checked',initialValue:true }]" checkedChildren="启动" unCheckedChildren="禁用" />
    </a-form-item>
  </a-form>
</template>
<script>
export default {
  props: {
    value: [Array, Object, Number, String]
  },
  data() {
    return {
      id:0,
      form: this.$form.createForm(this)
    };
  },
  async mounted() {
    console.log(this.value)
    if (JSON.stringify(this.value) !== "[]") {
      this.id = this.value._id;
      this.form.setFieldsValue({
        username: this.value.username,
        nickname: this.value.nickname,
        email: this.value.email,
        status:this.value.status,
        role: this.value.role
      })
    }
  },
  methods: {
    affirm(e) {
      let { $cloud, id, addData, editData } = this;
      let { handleCancel } = e;
      this.form.validateFields((err, values) => {
        if (!err) {
          if (id === 0) {
            addData(values);
          } else {
            editData(values);
          }
          handleCancel();
        }
      })
    },
    addData(values) {
      let that = this
      this.$cloud.users().add(values).then(res => {
        if (res) {
          this.$message.success("提交成功");
        }
        
      })
    },
    editData(values) {
      console.log("更新操作", this.id)
      this.$cloud.users().edit(this.id,values).then(res => {
        if (res) {
          this.$message.success("更新成功");
        }
      })
    }
  },
};
</script>