<template>
    <a-form :form="form">
        <a-form-item label="旧密码" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
            <a-input type="password" v-decorator="['old_password', { rules: [{ required: true, message: '不能为空' }] }]" />
        </a-form-item>
        <a-form-item label="新密码" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
            <a-input type="password" v-decorator="['new_password', { rules: [{ required: true, message: '不能为空' }] }]" />
        </a-form-item>
        <a-form-item label="确认新密码" :label-col="{ span: 5 }" :wrapper-col="{ span: 12 }">
            <a-input type="password" v-decorator="['check_password', { rules: [{ required: true, message: '不能为空' }] }]" />
        </a-form-item>
    </a-form>
</template>
<script>
import { mapActions } from 'vuex'
export default {
    props: {
        value: [Array, Object, Number, String]
    },
    data() {
        return {
            form: this.$form.createForm(this)
        };
    },
    async mounted() {
        this.id = this.value._id;
    },
    methods: {
        ...mapActions(['Logout']),
        affirm(e) {
            let { $cloud, id, editData } = this;
            let { handleCancel } = e;
            this.form.validateFields((err, values) => {
                console.log(err)
                if (!err) {
                    editData(values);
                    handleCancel();
                }
            })
        },
        editData(values) {
            if (values.new_password === values.check_password) {
                this.$cloud.users().edit(this.id, values).then(res => {
                    if (res) {
                        this.$message.success("修改成功");
                    }
                })
            } else {
                this.$message.error("两次新密码不一致");
            }

        }
    },
};
</script>