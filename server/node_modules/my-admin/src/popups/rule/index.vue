<template>
  <a-form :form="form">
    <a-form-item :labelCol="labelCol" :wrapperCol="wrapperCol" label="规则标题" hasFeedback>
      <a-input v-decorator="[
            'title',
            {rules: [{ required: true, message: '规则标题' }]}
          ]" placeholder="规则标题" />
    </a-form-item>
    <a-form-item :labelCol="labelCol" :wrapperCol="wrapperCol" label="规则名称" hasFeedback>
      <a-input v-decorator="[
            'name',
            {rules: [{ required: true, message: '规则名称' }]}
          ]" placeholder="规则名称" />
    </a-form-item>
    <a-form-item :labelCol="labelCol" :wrapperCol="wrapperCol" label="状态">
      <a-switch v-decorator="['status', { valuePropName: 'checked',initialValue:true }]" checkedChildren="显示" unCheckedChildren="隐藏" />
    </a-form-item>
    <a-form-item :labelCol="labelCol" :wrapperCol="wrapperCol" label="描述" hasFeedback>
      <a-textarea :rows="5" v-decorator="[
            'describe',
            {rules: [{ message: '描述' }]}
          ]" placeholder="..." />
    </a-form-item>
    <a-divider />
    <a-form-item :labelCol="labelCol" :wrapperCol="wrapperCol" label="表达式" hasFeedback>
      <div slot="extra">
        <p>规则表达式：&lt;model&gt;:&lt;action&gt; 例:order:get </p>
        <p>备注:*为通配符 *:* 表示所有操作"</p>
      </div>
      <a-input v-decorator="[
            'expression',
            {rules: [{ required: true, message: '表达式' }]}
          ]" placeholder="表达式" />
    </a-form-item>
  </a-form>
</template>
<script type="text/javascript">
// import empty from './empty.vue'
export default {
  components: {
    //empty
  },
  props: {
    value: [Array, Object, Number, String]
  },
  data() {
    return {
      id: 0,
      form: this.$form.createForm(this),
      mdl: {},
      labelCol: {
        xs: { span: 24 },
        sm: { span: 5 }
      },
      wrapperCol: {
        xs: { span: 24 },
        sm: { span: 16 }
      },
      // 向后端拉取可以用的操作列表
      permissionList: null,
    }
  },
  /**
   * 计算属性
   * @type {Object}
   */
  computed: {

  },
  /**
   * 数据监听
   * @type {Object}
   */
  watch: {

  },
  /**
   * 页面加载执行
   * @return {[type]} [description]
   */
  async mounted() {
    this.loadPermissionList();
    if (JSON.stringify(this.value) !== "[]") {
      this.id = this.value._id;
      this.form.setFieldsValue({
        title: this.value.title,
        name: this.value.name,
        describe: this.value.describe,
        status:this.value.status,
        expression: this.value.expression
      })
    }
  },
  /**
   * 页面方法
   * @type {Object}
   */
  methods: {
    loadPermissionList() {
      // permissionList
      new Promise(resolve => {
        const data = [
          { label: '新增', value: 'add', defaultChecked: false },
          { label: '查询', value: 'get', defaultChecked: false },
          { label: '修改', value: 'update', defaultChecked: false },
          { label: '列表', value: 'query', defaultChecked: false },
          { label: '删除', value: 'delete', defaultChecked: false },
          { label: '导入', value: 'import', defaultChecked: false },
          { label: '导出', value: 'export', defaultChecked: false }
        ]
        setTimeout(resolve(data), 1500)
      }).then(res => {
        this.permissionList = res
      })
    },
    // handler
    affirm(e) {
      let { $cloud, id, addData, editData } = this;
      let { handleCancel } = e;
      this.form.validateFields((err, values) => {
        if (!err) {
          if (id === 0) {
            addData(values);
          } else {
            editData(values);
          }
          handleCancel();
          // eslint-disable-next-line no-console
          console.log('Received values of form: ', values)
        }
      })
    },
    addData(values) {
      console.log("新增操作", values)
      this.$cloud.rules().add(values).then(res => {
        console.log("数据返回", res)
        this.$message.success("提交成功");
      })
    },
    editData(values) {
      console.log("更新操作", this.id)
      this.$cloud.rule().where({
        "_id": this.id
      }).update(values).then(res => {
        console.log("数据返回", res)
        this.$message.success("更新成功");
      })
    }
  }

}
</script>
<style type="text/css" lang="scss">
</style>