import Vue from 'vue'
import Vuex from 'vuex'

import app from './modules/app'
import user from './modules/user'

// default router permission control
//import permission from './modules/permission'

// dynamic router permission control (Experimental)
import permission from './modules/async-router'
import getters_a from './getters'
import getters_b from '@/store/getters.js'

Vue.use(Vuex)

// https://webpack.js.org/guides/dependency-management/#requirecontext
const modulesFiles = require.context('@/store', true, /\.js$/)

// you do not need `import app from './modules/app'`
// it will auto require all vuex module from modules file

const modules = modulesFiles.keys().reduce((modules, modulePath) => {
    // set './app.js' => 'app'
    const moduleName = modulePath.replace(/^\.\/(.*)\.\w+$/, '$1');
    console.log("读取moduleName", moduleName)
    if (moduleName !== "getters") {
        const value = modulesFiles(modulePath)
        modules[moduleName] = value.default
        return modules
    }
}, {})

let modules_b = {
    app,
    user,
    permission
}

let modules_a = modules || {}

let getters = Object.assign(getters_a, getters_b);

export default new Vuex.Store({
    modules: Object.assign(modules_a, modules_b),
    state: {

    },
    mutations: {

    },
    actions: {

    },
    getters: getters
})